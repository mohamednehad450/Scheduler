// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Admin {
  id       String @id @unique @default("admin")
  username String @unique
  password String
}

model Pin {
  channel Int     @id @unique
  label   String
  onState String
  orders  Order[]
}

model Order {
  id Int @id @default(autoincrement())

  Pin     Pin @relation(fields: [channel], references: [channel])
  channel Int

  duration Int
  offset   Int

  sequence   Sequence @relation(fields: [sequenceId], references: [id])
  sequenceId Int
}

model CronSequence {
  id         Int      @id @default(autoincrement())
  cron       Cron     @relation(fields: [cronId], references: [id])
  sequence   Sequence @relation(fields: [sequenceId], references: [id])
  cronId     Int
  sequenceId Int
}

model Cron {
  id           Int            @id @default(autoincrement())
  cron         String
  label        String
  CronSequence CronSequence[]
}

model Sequence {
  id            Int             @id @default(autoincrement())
  name          String
  orders        Order[]
  lastRun       DateTime?
  active        Boolean         @default(false)
  sequenceEvent SequenceEvent[]
  CronSequence  CronSequence[]
}

model SequenceEvent {
  id         Int      @id @default(autoincrement())
  date       DateTime
  sequenceId Int
  sequence   Sequence @relation(fields: [sequenceId], references: [id])
  eventType  String
}
